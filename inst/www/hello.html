<!DOCTYPE html>
<html>
  <head>
    <title>OpenCPU</title>
    
    <!-- Include order: first jquery, then opencpu.js, and then your code -->
    <script src="opencpu/jquery-1.10.2.min.js"></script>
    <script src="opencpu/opencpu-0.4.js"></script>
    <script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the value for 'myname'
        var myname = $("#namefield").val();
        
        
       $(function(){
       $("#btnExport").click(function(e) {
       var tabla = document.getElementById('dvData').outerHTML;
       
       tabla = tabla.replace("<table id=\"myTable\">", "<table>");
       window.open('data:application/vnd.ms-excel,' + $(tabla).html());
       //window.open('data:application/vnd.ms-excel,' + $('#dvData').html());
       e.preventDefault();
       });
       });

        
        //perform the request
        var req = ocpu.rpc("hello", {
                  myname : myname
        }, function(output){
          //$("#output").text(output.message);
          var response = output.message;
          //alert(response);
          var myArr = Array.from(response);
          
          var table = document.getElementById("myTable");
          var row1 = table.insertRow(1);
          var row2 = table.insertRow(2);
          var row3 = table.insertRow(3);
          var row4 = table.insertRow(4);
          var row5 = table.insertRow(5);
          var row6 = table.insertRow(6);
          var row7 = table.insertRow(7);
          var row8 = table.insertRow(8);
          var row9 = table.insertRow(9);
          var row10 = table.insertRow(10);
          var row11 = table.insertRow(11);
          var row12 = table.insertRow(12);
          var row13 = table.insertRow(13);
          var row14 = table.insertRow(14);
          var row15 = table.insertRow(15);
          var row16 = table.insertRow(16);
          var row17 = table.insertRow(17);
          var row18 = table.insertRow(18);
          var row19 = table.insertRow(19);
          var row20 = table.insertRow(20);
          var row21 = table.insertRow(21);
          var row22 = table.insertRow(22);
          var row23 = table.insertRow(23);
          var row24 = table.insertRow(24);
          
          var cell1 = row1.insertCell(0);
          var cell2 = row1.insertCell(1);
          cell1.innerHTML = "1";
          cell2.innerHTML = myArr[0];
            
          var cell3 = row2.insertCell(0);
          var cell4 = row2.insertCell(1);
          cell3.innerHTML = "2";
          cell4.innerHTML = myArr[1];
          
          var cell5 = row3.insertCell(0);
          var cell6 = row3.insertCell(1);
          cell5.innerHTML = "3";
          cell6.innerHTML = myArr[2];
          
          var cell7 = row4.insertCell(0);
          var cell8 = row4.insertCell(1);
          cell7.innerHTML = "4";
          cell8.innerHTML = myArr[3];
          
          var cell9 = row5.insertCell(0);
          var cell10 = row5.insertCell(1);
          cell9.innerHTML = "5";
          cell10.innerHTML = myArr[4];
          
          var cell11 = row6.insertCell(0);
          var cell12 = row6.insertCell(1);
          cell11.innerHTML = "6";
          cell12.innerHTML = myArr[5];
          
          var cell13 = row7.insertCell(0);
          var cell14 = row7.insertCell(1);
          cell13.innerHTML = "7";
          cell14.innerHTML = myArr[6];
          
          var cell15 = row8.insertCell(0);
          var cell16 = row8.insertCell(1);
          cell15.innerHTML = "8";
          cell16.innerHTML = myArr[7];
          
          var cell17 = row9.insertCell(0);
          var cell18 = row9.insertCell(1);
          cell17.innerHTML = "9";
          cell18.innerHTML = myArr[8];
          
          var cell19 = row10.insertCell(0);
          var cell20 = row10.insertCell(1);
          cell19.innerHTML = "10";
          cell20.innerHTML = myArr[9];
          
          var cell21 = row11.insertCell(0);
          var cell22 = row11.insertCell(1);
          cell21.innerHTML = "11";
          cell22.innerHTML = myArr[10];
          
          var cell23 = row12.insertCell(0);
          var cell24 = row12.insertCell(1);
          cell23.innerHTML = "12";
          cell24.innerHTML = myArr[11];
          
          var cell24 = row13.insertCell(0);
          var cell25 = row13.insertCell(1);
          cell24.innerHTML = "13";
          cell25.innerHTML = myArr[12];
          
          var cell26 = row14.insertCell(0);
          var cell27 = row14.insertCell(1);
          cell26.innerHTML = "14";
          cell27.innerHTML = myArr[13];
          
          var cell28 = row15.insertCell(0);
          var cell29 = row15.insertCell(1);
          cell28.innerHTML = "15";
          cell29.innerHTML = myArr[14];
          
          var cell30 = row16.insertCell(0);
          var cell31 = row16.insertCell(1);
          cell30.innerHTML = "16";
          cell31.innerHTML = myArr[15];
          
          var cell32 = row17.insertCell(0);
          var cell33 = row17.insertCell(1);
          cell32.innerHTML = "17";
          cell33.innerHTML = myArr[16];
          
          var cell34 = row18.insertCell(0);
          var cell35 = row18.insertCell(1);
          cell34.innerHTML = "18";
          cell35.innerHTML = myArr[17];
          
          var cell36 = row19.insertCell(0);
          var cell37 = row19.insertCell(1);
          cell36.innerHTML = "19";
          cell37.innerHTML = myArr[18];
          
          var cell38 = row20.insertCell(0);
          var cell39 = row20.insertCell(1);
          cell38.innerHTML = "20";
          cell39.innerHTML = myArr[19];
          
          var cell40 = row21.insertCell(0);
          var cell41 = row21.insertCell(1);
          cell40.innerHTML = "21";
          cell41.innerHTML = myArr[20];
          
          var cell42 = row22.insertCell(0);
          var cell43 = row22.insertCell(1);
          cell42.innerHTML = "22";
          cell43.innerHTML = myArr[21];
          
          var cell44 = row23.insertCell(0);
          var cell45 = row23.insertCell(1);
          cell44.innerHTML = "23";
          cell45.innerHTML = myArr[22];
          
          var cell46 = row24.insertCell(0);
          var cell47 = row24.insertCell(1);
          cell46.innerHTML = "24";
          cell47.innerHTML = myArr[23];
          
        });
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });
    });
    </script>
    
    <style>
      /*#output{
        height: 500px;
        width: 80px;
        border: 1px solid gray;
        padding: 3px;
        background-color:white;
      }*/
      
      #myTable{
        
        border: 1px solid gray;
        padding: 1px;
        background-color:white;
      }
      
      body {background-color: #05365B;}
      
    </style>
    
  </head>
    
  <body>
    <h1>OpenCPU</h1>
    
    
    <p>
    <button id="submitbutton" type="button">Obtener</button>
    </p>
    
    <div id="dvData">
    
     <table id="myTable">
     <tr>
       <td>Hora</td>
       <td>Pronostico</td>
     </tr>
     </table>
    
    </div>
      
    <input type="button" id="btnExport" value="Excel" />
    
    <p id="output">
    </p>
  
    <br />
    
  </body>
</html>
